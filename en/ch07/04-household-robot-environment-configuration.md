**Benchmark Evaluation of Low-Level Operations in Household Organization Tasks**

**[paper](https://arxiv.org/abs/2412.13211)** | **[project page](https://arth-shukla.github.io/mshab/)** | **[model](https://huggingface.co/arth-shukla/mshab_checkpoints)** | **[dataset](https://arth-shukla.github.io/mshab/#dataset-section)** | **[material](https://sites.google.com/view/maniskill-hab)**

---

## Installation and Setup

1. **Environment Installation**

   ```bash
   conda create -n mshab python=3.9
   conda activate mshab
   ```

2. **Install ManiSkill3 and Project Code**

   ```bash
   git clone https://github.com/haosulab/ManiSkill.git -b mshab --single-branch
   pip install -e ManiSkill
   pip install -e .  # Optional: Install training/development dependencies with pip install -e .[train,dev]
   ```

3. **Download Required Datasets**

   ```bash
   for dataset in ycb ReplicaCAD ReplicaCADRearrange; do python -m mani_skill.utils.download_asset "$dataset"; done
   ```

4. **Import Environment**

   ```python
   import mshab.envs
   ```

---

## [Optional] Checkpoints, Datasets, and Data Generation

- Models and datasets can be obtained from HuggingFace (approximately 490GB):

  ```bash
  huggingface-cli login

  huggingface-cli download arth-shukla/mshab_checkpoints --local-dir mshab_checkpoints

  export MS_ASSET_DIR="~/.maniskill"
  export MSHAB_DATASET_DIR="$MS_ASSET_DIR/data/scene_datasets/replica_cad_dataset/rearrange-dataset"

  huggingface-cli download --repo-type dataset arth-shukla/MS-HAB-TidyHouse --local-dir "$MSHAB_DATASET_DIR/tidy_house"
  huggingface-cli download --repo-type dataset arth-shukla/MS-HAB-PrepareGroceries --local-dir "$MSHAB_DATASET_DIR/prepare_groceries"
  huggingface-cli download --repo-type dataset arth-shukla/MS-HAB-SetTable --local-dir "$MSHAB_DATASET_DIR/set_table"
  ```

- Generate data using scripts (custom trajectory filtering criteria available):

  ```bash
  bash scripts/gen_dataset.sh
  ```

---

## Quick Start

MS-HAB provides:

- **Evaluation Environment** `SequentialTask-v0`: For complete task evaluation (supports subtask chains)

- **Training Environment** `[Name]SubtaskTrain-v0`: For training individual skill policies, e.g., `PickSubtaskTrain-v0`

Example code:

```python
import gymnasium as gym
from mani_skill.vector.wrappers.gymnasium import ManiSkillVectorEnv
import mshab.envs
from mshab.envs.planner import plan_data_from_file

task = "tidy_house"
subtask = "pick"
split = "train"

plan_data = plan_data_from_file(REARRANGE_DIR / "task_plans" / task / subtask / split / "all.json")
spawn_data_fp = REARRANGE_DIR / "spawn_data" / task / subtask / split / "spawn_data.pt"

env = gym.make(
    f"{subtask.capitalize()}SubtaskTrain-v0",
    num_envs=252,
    obs_mode="rgbd",
    sim_backend="gpu",
    robot_uids="fetch",
    control_mode="pd_joint_delta_pos",
    reward_mode="normalized_dense",
    render_mode="rgb_array",
    max_episode_steps=200,
    task_plans=plan_data.plans,
    scene_builder_cls=plan_data.dataset,
    spawn_data_fp=spawn_data_fp,
)

venv = ManiSkillVectorEnv(env, max_episode_steps=1000, ignore_terminations=True)
obs, info = venv.reset()
```

---

## Scene and Task Customization

- **Scenes**: ReplicaCAD provides 84 apartment scenes (63 training, 21 validation)

- **Task Plans**: Define task sequences and goals, e.g., "Pick → Place"

- **Data Generation**: Initial states of robots and objects, pre-generated by scripts (for stability in GPU simulation)

### Simple Customization

- Can load only partial task plans for debugging

- Success/failure criteria can be adjusted via `task_cfgs` (e.g., placement target range)

### Advanced Customization

- Task chains can be extended (must follow logical sequence, e.g., avoid "Pick → Pick")

- Objects/scenes can be modified by changing configurations and using `SceneBuilder`

---

## Training

Supports multiple algorithms (SAC, PPO, Behavior Cloning, Diffusion Policies):

```bash
bash scripts/train_[algo].sh
```

Example:

```bash
python -m mshab.train_sac \
  mshab_checkpoints/rl/tidy_house/pick/all/config.yml \
  algo.gamma=0.8
```

**Resume Training**

```bash
python -m mshab.train_ppo \
  mshab_checkpoints/rl/tidy_house/pick/all/config.yml \
  model_ckpt=mshab_checkpoints/rl/tidy_house/pick/all/policy.pt \
  algo.lr=1e-3
```

---

## Evaluation

Data must be downloaded or generated first. Use the following scripts for complete task or subtask evaluation:

```bash
bash scripts/evaluate_sequential_task.sh
```